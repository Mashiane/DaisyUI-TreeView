(function(l,c){typeof exports=="object"&&typeof module<"u"?module.exports=c():typeof define=="function"&&define.amd?define(c):(l=typeof globalThis<"u"?globalThis:l||self,l.DaisyUITreeView=c())})(this,function(){"use strict";const l={data:[],expandIconUrl:"./assets/chevron-down-solid.svg",collapseIconUrl:"./assets/chevron-right-solid.svg",hasCheckbox:!1,treeName:"treeView",multipleSelect:!1,multipleCheck:!1,iconHeight:"16px",iconWidth:"16px",inlineEdit:!1,dragNDrop:!1};class c{constructor(t,s={}){if(this.element=t,this.settings={...l,...s},this.treeName=this._normalizeId(this.settings.treeName),this.tree=[],this.nodeMap=new Map,this._checkedNodes=new Set,this._selectedNodes=new Set,this._visibleNodes=new Set,this.settings.data){let e=Array.isArray(this.settings.data)?JSON.parse(JSON.stringify(this.settings.data)):[];this.tree=e,delete this.settings.data}this._refresh(),this.settings.dragNDrop&&this._enableDragAndDrop(),this.element.addEventListener("blur",this._onBlur.bind(this),!0),this.element.addEventListener("keydown",this._onKeydown.bind(this)),this.element.addEventListener("click",e=>this._onClick(e))}_toggleVisibility(t,s){t&&(s?t.classList.remove("hidden"):t.classList.add("hidden"))}_getElementById(t){return document.getElementById(t)}_onCheckboxChange(t,s){if(!this.nodeExists(t))return;const e=this.findNode(t);this.checkNode(t,s),this._dispatchEvent("nodeChecked",{node:e,checked:s})}collapseAll(){const t=s=>{for(const e of s)this._collapseNode(e.nodeId),e.nodes&&t(e.nodes)};t(this.tree)}expandAll(){const t=s=>{for(const e of s)this._expandNode(e.nodeId),e.nodes&&t(e.nodes)};t(this.tree)}_refresh(){const t=document.createDocumentFragment();this._initializeData({nodes:this.tree}),this._build(t,this.tree),this.element.innerHTML="",this.element.appendChild(t)}_initializeData(t){if(t.nodes)for(const s of t.nodes)s.nodeId=this._normalizeId(s.nodeId),s.parentId=this._normalizeId(s.parentId),this._visibleNodes.add(s.nodeId),this.nodeMap.set(s.nodeId,s),s.nodes&&this._initializeData({nodes:s.nodes})}_build(t,s){for(const e of s){const i=document.createElement("li");if(i.id=`${this.treeName}-${e.nodeId}`,i.classList.add("list-item"),i.dataset.id=e.nodeId,i.setAttribute("role","treeitem"),i.setAttribute("aria-expanded",e.expanded||!1),i.setAttribute("aria-selected",this._selectedNodes.has(e.nodeId)||!1),this._visibleNodes.has(e.nodeId)||this._toggleVisibility(i,!1),this._selectedNodes.has(e.nodeId)&&i.classList.add("menu-active"),e.disabled&&(i.setAttribute("aria-disabled","true"),i.classList.add("menu-disabled")),e.nodes&&e.nodes.length>0){const d=document.createElement("details");d.id=`${this.treeName}-${e.nodeId}-details`,d.dataset.id=e.nodeId,d.classList.add("xdetails"),i.classList.add("xdetails"),e.expanded&&d.setAttribute("open","");const n=document.createElement("summary");if(n.id=`${this.treeName}-${e.nodeId}-summary`,n.dataset.id=e.nodeId,n.classList.add("xsummary"),e.iconUrl===""&&(e.iconUrl=this.settings.collapseIconUrl),e.iconUrl){const r=document.createElement("svg-renderer");r.id=`${this.treeName}-${e.nodeId}-icon`,r.dataset.id=e.nodeId,r.dataset.src=e.expanded?this.settings.expandIconUrl:this.settings.collapseIconUrl,r.classList.add("state-icon","xicon"),r.setAttribute("style","pointer-events:none;"),r.setAttribute("fill","currentColor"),r.setAttribute("data-js","enabled"),r.setAttribute("width",this.settings.iconWidth),r.setAttribute("height",this.settings.iconHeight),n.appendChild(r)}if(this.settings.hasCheckbox){const r=document.createElement("input");r.id=`${this.treeName}-${e.nodeId}-check`,r.type="checkbox",r.classList.add("checkbox"),r.dataset.id=e.nodeId,r.checked=this._checkedNodes.has(e.nodeId),n.appendChild(r)}const o=document.createElement("input");o.id=`${this.treeName}-${e.nodeId}-input`,o.type="text",o.value=e.text,o.classList.add("input","input-ghost","hidden","input-sm","w-full","xinput"),o.dataset.id=e.nodeId,n.appendChild(o);const a=document.createElement("span");a.id=`${this.treeName}-${e.nodeId}-text`,a.textContent=e.text,a.dataset.id=e.nodeId,a.classList.add("xspan"),n.appendChild(a),d.appendChild(n);const h=document.createElement("ul");h.id=`${this.treeName}-${e.nodeId}-ul`,h.dataset.id=e.nodeId,this._build(h,e.nodes),d.appendChild(h),i.appendChild(d)}else{const d=document.createElement("a");if(d.id=`${this.treeName}-${e.nodeId}-anchor`,d.dataset.id=e.nodeId,d.classList.add("xanchor"),e.href&&d.setAttribute("href",e.href),e.iconUrl){const a=document.createElement("svg-renderer");a.dataset.id=e.nodeId,a.id=`${this.treeName}-${e.nodeId}-icon`,a.dataset.src=e.expanded?this.settings.expandIconUrl:this.settings.collapseIconUrl,a.classList.add("state-icon"),a.setAttribute("style","pointer-events:none;"),a.setAttribute("fill","currentColor"),a.setAttribute("data-js","enabled"),a.setAttribute("width",this.settings.iconWidth),a.setAttribute("height",this.settings.iconHeight),d.appendChild(a)}if(this.settings.hasCheckbox){const a=document.createElement("input");a.id=`${this.treeName}-${e.nodeId}-check`,a.type="checkbox",a.classList.add("checkbox"),a.dataset.id=e.nodeId,a.checked=this._checkedNodes.has(e.nodeId),d.appendChild(a)}const n=document.createElement("input");n.id=`${this.treeName}-${e.nodeId}-input`,n.type="text",n.value=e.text,n.classList.add("input","input-ghost","hidden","input-sm","w-full","xinput"),n.dataset.id=e.nodeId,d.appendChild(n);const o=document.createElement("span");o.id=`${this.treeName}-${e.nodeId}-text`,o.textContent=e.text,o.dataset.id=e.nodeId,o.classList.add("xspan"),d.appendChild(o),i.appendChild(d)}t.appendChild(i)}}_onClick(t){const s=t.target.closest(".checkbox");if(s){t.stopPropagation();const n=this._normalizeId(s.dataset.id);if(this.nodeExists(n)){const o=s.checked;this._onCheckboxChange(n,o)}return}const e=t.target.closest(".xsummary");if(e){t.stopPropagation();const n=this._normalizeId(e.dataset.id);if(!this.nodeExists(n))return;const o=this.findNode(n);let h=this._getElementById(`${this.treeName}-${n}-details`).hasAttribute("open");h=!h,o.expanded=h;const r=h?"nodeExpanded":"nodeCollapsed",f=this._getElementById(`${this.treeName}-${n}-icon`);f&&(h?f.setAttribute("data-src",this.settings.expandIconUrl):f.setAttribute("data-src",this.settings.collapseIconUrl),o.iconUrl=f.getAttribute("data-src")),this._dispatchEvent(r,{node:o});return}const i=t.target.closest(".xspan");if(i){t.stopPropagation();const n=this._normalizeId(i.dataset.id);if(!this.nodeExists(n))return;const o=this.findNode(n);if(this.settings.inlineEdit&&t.target.id===`${this.treeName}-${n}-text`){this._enableInlineEdit(n);return}this._dispatchEvent("nodeClick",{node:o});return}const d=t.target.closest(".xanchor");if(d){t.stopPropagation();const n=this._normalizeId(d.dataset.id);if(!this.nodeExists(n))return;const o=this.findNode(n);if(this.settings.inlineEdit){this._enableInlineEdit(n);return}this._dispatchEvent("nodeClick",{node:o});return}}_enableDragAndDrop(){this.element.addEventListener("dragend",t=>{const s=this.element.querySelector(".drag-over");s&&s.classList.remove("drag-over")}),this.element.addEventListener("dragstart",t=>{const s=t.target.closest(".list-item");s&&t.dataTransfer.setData("id",s.dataset.id)}),this.element.addEventListener("dragover",t=>{t.preventDefault();const s=t.target.closest(".list-item");s&&s.classList.add("drag-over")}),this.element.addEventListener("dragleave",t=>{const s=t.target.closest(".list-item");s&&s.classList.remove("drag-over")}),this.element.addEventListener("drop",t=>{t.preventDefault();const s=t.target.closest(".list-item");if(!s)return;const e=t.dataTransfer.getData("id"),i=s.dataset.id;if(e===i)return;const d=this.findNode(e),n=this.findNode(i);let o=n;for(;o;){if(o.nodeId===e)return;o=this.findNode(o.parentId)}d&&n&&(this._dispatchEvent("nodeDragStart",{draggedNode:d}),this._dispatchEvent("nodeDrop",{draggedNode:d,targetNode:n}),this.removeNode(e),this.addNode(i,d.nodeId,d.iconUrl,d.text,d.href,d.hasCheckbox),this._refresh())})}_normalizeId(t){return(t??"").toString().trim().toLowerCase()}_cstr(t){return(t??"").toString()}nodeExists(t){const s=this._normalizeId(t);return s===""?!1:this.nodeMap.has(s)}findNode(t){const s=this._normalizeId(t);return s===""?null:this.nodeMap.get(s)||null}addNode(t,s,e="",i,d=""){if(t=this._normalizeId(t),s=this._normalizeId(s),e=this._cstr(e),i=this._cstr(i),d=this._cstr(d),s==="")return;const n=this.settings.hasCheckbox||!1,o={nodeId:s,parentId:t,iconUrl:e,text:i,href:d,hasCheckbox:n};if(t==="")this.tree.push(o);else{const a=this.findNode(t);a&&(a.nodes=a.nodes||[],a.nodes.push(o),this.nodeMap.set(t,a))}this.nodeMap.set(s,o),this._visibleNodes.add(s)}hideNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;this._visibleNodes.delete(i.nodeId),i.visible=!1;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&this._toggleVisibility(d,!1),i.nodes&&i.nodes.forEach(n=>e(n))};e(s)}showNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;this._visibleNodes.add(i.nodeId),i.visible=!0;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&this._toggleVisibility(d,!0),i.nodes&&i.nodes.forEach(n=>e(n))};e(s)}checkNode(t,s){if(!this.nodeExists(t))return;const e=this.findNode(t),i=(d,n)=>{if(!d)return;n?this._checkedNodes.add(d.nodeId):this._checkedNodes.delete(d.nodeId),d.checked=n;const o=this._getElementById(`${this.treeName}-${d.nodeId}-check`);o&&(o.checked=n),d.nodes&&d.nodes.forEach(a=>i(a,n))};i(e,s)}expandNode(t,s){s?this._expandNode(t):this._collapseNode(t)}removeNode(t){if(t=this._normalizeId(t),!this.nodeExists(t))return;this.nodeMap.delete(t);const s=this._getElementById(`${this.treeName}-${t}`);s&&s.remove()}_expandNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t);s.expanded=!0;const e=this._getElementById(`${this.treeName}-${s.nodeId}-details`);e&&e.setAttribute("open","")}_collapseNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t);s.expanded=!1;const e=this._getElementById(`${this.treeName}-${s.nodeId}-details`);e&&e.removeAttribute("open")}enableNode(t,s){s?this._enableNode(t):this._disableNode(t)}_enableNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;i.disabled=!1;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&d.classList.remove("menu-disabled"),i.nodes&&i.nodes.forEach(n=>e(n))};e(s)}_disableNode(t){if(!this.nodeExists(t))return;const s=this.findNode(t),e=i=>{if(!i)return;i.disabled=!0;const d=this._getElementById(`${this.treeName}-${i.nodeId}`);d&&d.classList.add("menu-disabled"),i.nodes&&i.nodes.forEach(n=>e(n))};e(s)}clear(){this.nodeMap.clear(),this.tree=[],this._checkedNodes.clear(),this._selectedNodes.clear(),this._visibleNodes.clear()}getChildren(t){if(!this.nodeExists(t))return[];const s=this.findNode(t);return Array.isArray(s.nodes)?[...s.nodes]:[]}removeChildren(t){if(!this.nodeExists(t))return;const s=this.findNode(t);s.nodes&&(s.nodes.forEach(e=>this._checkedNodes.delete(e.nodeId)),s.nodes.forEach(e=>this._selectedNodes.delete(e.nodeId)),s.nodes.forEach(e=>this._visibleNodes.delete(e.nodeId)),s.nodes.forEach(e=>this.removeNode(e.nodeId))),s.nodes=[]}updateNode(t,s,e,i=""){if(t=this._normalizeId(t),s=this._cstr(s),e=this._cstr(e),i=this._cstr(i),t===""||!this.nodeExists(t))return;const d=this.findNode(t);d.iconUrl=s,d.text=e,d.href=i;const n=this._getElementById(`${this.treeName}-${d.nodeId}-text`);n&&(n.textContent=e);const o=this._getElementById(`${this.treeName}-${d.nodeId}-input`);o&&(o.value=e);const a=this._getElementById(`${this.treeName}-${d.nodeId}-icon`);a&&(a.dataset.src=s)}selectNode(t,s){if(!this.nodeExists(t))return;const e=this.findNode(t),i=(d,n)=>{if(!d)return;n?this._selectedNodes.add(d.nodeId):this._selectedNodes.delete(d.nodeId),d.selected=n;const o=this._getElementById(`${this.treeName}-${d.nodeId}`);o&&(n?o.classList.add("menu-active"):o.classList.remove("menu-active")),d.nodes&&d.nodes.forEach(a=>i(a,n))};i(e,s)}clearSelected(){this._selectedNodes.forEach(t=>this.selectNode(t.nodeId,!1)),this._selectedNodes.clear()}clearChecked(){this._checkedNodes.forEach(t=>this.checkNode(t.nodeId,!1)),this._checkedNodes.clear()}selectNodes(t){this._selectedNodes.forEach(e=>this.selectNode(e.nodeId,!1)),new Set(t.map(e=>this._normalizeId(e))).forEach(e=>this.selectNode(e,!0))}getSelectedNode(t=!1){const s=this.element.querySelector(".menu-active");if(!s)return null;const e=this._normalizeId(s.dataset.id),i=this.findNode(e);return!i||!t?i:{...i,nodes:i.nodes??[]}}getSelectedNodes(){return Array.from(this._selectedNodes)}getCheckedNodes(){return Array.from(this._checkedNodes)}checkNodes(t){this._checkedNodes.forEach(e=>this.checkNode(e.nodeId,!1));const s=new Set(t.map(e=>this._normalizeId(e)));s.forEach(e=>this.checkNode(e,!0)),this._dispatchEvent("nodesChecked",{nodeIds:s})}enableInlineEditing(t){this._enableInlineEdit(t)}refresh(){this._refresh()}_dispatchEvent(t,s){const e=new CustomEvent(t,{detail:s});this.element.dispatchEvent(e)}_onBlur(t){const s=t.target.closest("input.xinput");if(!s)return;const e=this._normalizeId(s.dataset.id),i=this.findNode(e);if(!i)return;const d=this._getElementById(`${this.treeName}-${e}-text`);if(!d)return;const n=i.text;if(s.value.trim()===""){this._toggleVisibility(s,!1),this._toggleVisibility(d,!0),this._dispatchEvent("nodeEditCancelled",{node:i});return}if(s.value.trim()===n){this._toggleVisibility(s,!1),this._toggleVisibility(d,!0),this._dispatchEvent("nodeEditCancelled",{node:i});return}i.text=s.value.trim(),d.textContent=s.value.trim(),s.value=s.value.trim(),this._toggleVisibility(s,!1),this._toggleVisibility(d,!0),this._dispatchEvent("nodeEdited",{node:i})}_onKeydown(t){const s=t.target.closest("input.xinput");if(!s)return;const e=this._normalizeId(s.dataset.id),i=this.findNode(e);if(!i)return;const d=this._getElementById(`${this.treeName}-${e}-text`);if(!d)return;const n=i.text;t.key==="Enter"?s.blur():t.key==="Escape"&&(i.text=n,d.textContent=n,s.value=n,s.blur())}_enableInlineEdit(t){const s=this.findNode(t);if(!s)return;const e=this._getElementById(`${this.treeName}-${t}-text`),i=this._getElementById(`${this.treeName}-${t}-input`);!e||!i||(i.value=s.text,this._toggleVisibility(e,!1),this._toggleVisibility(i,!0),i.focus())}}return c});
